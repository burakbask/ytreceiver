<script>
  // Sayfa yüklendiğinde, parent veya opener’dan gelecek mesajları bekle
  window.addEventListener('message', ev => {
    // Güvenlik: sadece bizim domain’den geleni al
    if (ev.origin !== 'https://www.youtube.com' && ev.origin !== window.location.origin) {
      console.warn('Bilinmeyen origin:', ev.origin);
      return;
    }

    let data;
    try {
      data = JSON.parse(ev.data);
    } catch {
      console.error('Mesaj JSON değil:', ev.data);
      return;
    }

    // Aynı render mantığın:
    const ci = document.getElementById('channel-info');
    ci.innerHTML = `
      <strong>Channel ID:</strong> ${data.channelId}<br>
      <strong>Channel Name:</strong> ${data.channelName}<br>
      <strong>Channel Handle:</strong> ${data.channelHandle || 'Tespit edilemedi'}
    `;

    const ul = document.getElementById('subscriptions-list');
    if (!data.subs || data.subs.length === 0) {
      ul.innerHTML = '<li>Abonelik bulunamadı.</li>';
    } else {
      ul.innerHTML = data.subs
        .map(s => `<li><a href="${s.url}" target="_blank">${s.title}</a></li>`)
        .join('');
    }
  }, false);

  // eğer istersen, sayfa yüklendiğinde parent’a “hazırım” mesajı gönderebilir
  window.opener?.postMessage(JSON.stringify({ status: 'ready' }), '*');
</script>
