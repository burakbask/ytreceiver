<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Verileri</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Font Awesome for link icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --primary: #ff0000;
      --bg: #121212;
      --card-bg: #1e1e1e;
      --text: #e0e0e0;
      --accent: #bb86fc;
      --transition: 0.3s;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
    }
    body {
      background: linear-gradient(135deg, #282828, #121212);
      color: var(--text);
      padding: 2rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--primary);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    #receiver-container {
      width: 100%;
      max-width: 600px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      overflow: hidden;
      transition: transform var(--transition);
      margin-bottom: 2rem;
    }
    #receiver-container:hover {
      transform: translateY(-5px);
    }
    #channel-info {
      padding: 1.5rem;
      border-bottom: 1px solid #333;
      animation: fadeIn var(--transition) ease-out;
    }
    #channel-info strong {
      color: var(--accent);
    }
    .button-container {
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem 1.5rem;
      border-bottom: 1px solid #333;
    }
    .section-button {
      flex: 1;
      padding: 0.75rem;
      background: var(--primary);
      color: var(--text);
      text-align: center;
      font-size: 1rem;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: background var(--transition);
      border-radius: 4px;
    }
    .section-button:hover {
      background: #cc0000;
    }
    .section-content {
      display: none;
      padding: 1rem 1.5rem;
      animation: fadeIn var(--transition) ease-out;
    }
    .section-content.active {
      display: block;
    }
    #video-info strong, #comments strong {
      color: var(--accent);
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin: 0.75rem 0;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }
    .subscription-name {
      flex: 1;
      font-weight: 500;
    }
    .subscription-link {
      color: var(--primary);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color var(--transition);
    }
    .subscription-link:hover {
      color: var(--accent);
    }
    .subscription-link i {
      margin-right: 0.25rem;
    }
    .comment-item {
      margin: 1rem 0;
      padding: 0.75rem;
      background: #252525;
      border-radius: 8px;
      width: 100%; /* Kapsayıcıya tam sığsın */
      box-sizing: border-box;
    }
    .comment-item strong {
      display: block; /* Her bir strong ayrı satırda */
      margin-bottom: 0.25rem;
    }
    .comment-content {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      word-wrap: break-word; /* Uzun metinler kaymasın, satır sonuna aksın */
      max-width: 100%; /* Kapsayıcıyı aşmasın */
    }
    .error-message {
      color: #ff5555;
      font-style: italic;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <h2>Kaydedilmiş YouTube Verileri</h2>
  <div id="receiver-container">
    <div id="channel-info">Gönderilen kanal verileri bekleniyor...</div>
    <div class="button-container">
      <button class="section-button" onclick="toggleSection('subscriptions-list')">Abonelik Listesi</button>
      <button class="section-button" onclick="toggleSection('video-info')">Video Bilgileri</button>
      <button class="section-button" onclick="toggleSection('comments')">Yorumlar</button>
    </div>
    <div id="subscriptions-list" class="section-content active">
      <ul><li>Veri bekleniyor...</li></ul>
    </div>
    <div id="video-info" class="section-content">Gönderilen video verileri bekleniyor...</div>
    <div id="comments" class="section-content">Gönderilen yorumlar bekleniyor...</div>
  </div>

  <script>
    // Section toggle fonksiyonu
    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section.classList.contains('active')) {
        section.classList.remove('active');
      } else {
        // Diğer açık bölümleri kapat
        document.querySelectorAll('.section-content.active').forEach(el => {
          el.classList.remove('active');
        });
        section.classList.add('active');
      }
    }

    window.opener?.postMessage(JSON.stringify({ status: 'ready' }), 'https://www.youtube.com');

    window.addEventListener('message', ev => {
      if (ev.origin !== 'https://www.youtube.com' &&
          ev.origin !== 'https://ytreceiver.vercel.app') {
        console.warn('Bilinmeyen origin:', ev.origin);
        return;
      }

      let data;
      try { data = JSON.parse(ev.data); }
      catch { console.error('Mesaj JSON değil:', ev.data); return; }

      // Kanal bilgileri
      if (data.subs || data.channelId) {
        const ci = document.getElementById('channel-info');
        ci.innerHTML = `
          <strong>Channel ID:</strong> ${data.channelId || 'N/A'}<br>
          <strong>Channel Name:</strong> ${data.channelName || 'N/A'}<br>
          <strong>Channel Handle:</strong> ${data.channelHandle || 'Tespit edilemedi'}
        `;

        const ul = document.getElementById('subscriptions-list').querySelector('ul');
        if (!data.subs || data.subs.length === 0) {
          ul.innerHTML = '<li>Abonelik bulunamadı.</li>';
        } else {
          ul.innerHTML = data.subs
            .map(s => `
              <li>
                <span class="subscription-name">${s.title}</span>
                <a href="${s.url}" target="_blank" rel="noopener" class="subscription-link">
                  <i class="fas fa-link"></i>Link
                </a>
              </li>
            `)
            .join('');
        }
      }

      // Video bilgileri
      if (data.videoInfo) {
        const vi = document.getElementById('video-info');
        vi.innerHTML = `
          <strong>Başlık:</strong> ${data.videoInfo.title || 'N/A'}<br>
          <strong>Kanal Adı:</strong> ${data.videoInfo.channelName || 'N/A'}<br>
          <strong>Abone Sayısı:</strong> ${data.videoInfo.subscriberCount || 'N/A'}<br>
          <strong>Beğeni Sayısı:</strong> ${data.videoInfo.likeCountText || 'N/A'}<br>
          <strong>Görüntülenme Sayısı:</strong> ${data.videoInfo.viewCount || 'N/A'}<br>
          <strong>Açıklama:</strong> ${data.videoInfo.description || 'N/A'}
        `;
      }

      // Yorumlar
      if (data.comments) {
        const commentsSection = document.getElementById('comments');
        if (!data.comments || data.comments.length === 0) {
          commentsSection.innerHTML = '<p class="error-message">Yorum bulunamadı veya yorumlar kapalı.</p>';
        } else {
          commentsSection.innerHTML = `
            <ul>
              ${data.comments
                .map(c => `
                  <li class="comment-item">
                    <strong>Yazar:</strong> ${c.author || 'Bilinmiyor'}<br>
                    <strong>Yayınlanma Zamanı:</strong> ${c.publishedTime || 'N/A'}<br>
                    <div class="comment-content">${c.content || 'Yorum içeriği yok'}</div>
                  </li>
                `)
                .join('')}
            </ul>
          `;
        }
      }
    }, false);
  </script>
</body>
</html>
